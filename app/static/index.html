<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ColdVault - Backup Dashboard</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1><i class="ph ph-shield-check"></i> ColdVault</h1>
            </div>
            <nav class="sidebar-nav">
                <a href="#/dashboard" class="nav-item" onclick="event.preventDefault(); router.navigate('/dashboard');">
                    <i class="ph ph-gauge"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#/jobs" class="nav-item" onclick="event.preventDefault(); router.navigate('/jobs');">
                    <i class="ph ph-list-bullets"></i>
                    <span>Backup Jobs</span>
                </a>
                <div class="nav-item has-submenu" id="metrics-nav-item">
                    <div class="nav-item-header" onclick="toggleSubmenu('metrics')">
                        <div>
                            <i class="ph ph-chart-line"></i>
                            <span>Metrics</span>
                        </div>
                        <i class="ph ph-caret-down submenu-icon"></i>
                    </div>
                    <div class="submenu" id="metrics-submenu">
                        <a href="#/metrics/overview" class="nav-item submenu-item" onclick="event.preventDefault(); router.navigate('/metrics/overview');">
                            <span>Overview</span>
                        </a>
                        <a href="#/metrics/history" class="nav-item submenu-item" onclick="event.preventDefault(); router.navigate('/metrics/history');">
                            <span>History</span>
                        </a>
                        <a href="#/metrics/projection" class="nav-item submenu-item" onclick="event.preventDefault(); router.navigate('/metrics/projection');">
                            <span>Projections</span>
                        </a>
                    </div>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <div id="notification" class="notification"></div>
            
            <div id="main-tab-dashboard" class="main-tab-content">
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <h3><i class="ph ph-folder"></i> Total Jobs</h3>
                        <div class="value" id="stat-jobs">-</div>
                        <div class="stat-subtitle" id="stat-jobs-enabled">-</div>
                    </div>
                    <div class="stat-card">
                        <h3><i class="ph ph-check-circle"></i> Success Rate</h3>
                        <div class="value" id="stat-success-rate">-</div>
                        <div class="stat-subtitle" id="stat-successful">-</div>
                    </div>
                    <div class="stat-card">
                        <h3><i class="ph ph-x-circle"></i> Failed Backups</h3>
                        <div class="value" id="stat-failed">-</div>
                        <div class="stat-subtitle" id="stat-total-runs">-</div>
                    </div>
                    <div class="stat-card">
                        <h3><i class="ph ph-hard-drives"></i> Total Storage</h3>
                        <div class="value" id="stat-storage">-</div>
                        <div class="stat-subtitle" id="stat-storage-tb">-</div>
                    </div>
                    <div class="stat-card">
                        <h3><i class="ph ph-currency-dollar"></i> Monthly Cost</h3>
                        <div class="value" id="stat-cost">-</div>
                        <div class="stat-subtitle" id="stat-annual-cost">-</div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h3><i class="ph ph-clock-clockwise"></i> Recent Activity</h3>
                        </div>
                        <div class="dashboard-card-body">
                            <div id="recent-activity" class="loading">Loading activity...</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h3><i class="ph ph-list-bullets"></i> Job Status Overview</h3>
                        </div>
                        <div class="dashboard-card-body">
                            <div id="job-status-overview" class="loading">Loading jobs...</div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="dashboard-card-header">
                        <h3><i class="ph ph-chart-pie"></i> Storage by Job</h3>
                    </div>
                    <div class="dashboard-card-body">
                        <div id="storage-breakdown" class="loading">Loading storage breakdown...</div>
                    </div>
                </div>
            </div>
            
            <div id="main-tab-jobs" class="main-tab-content active">
                <div class="jobs-section">
                    <div class="jobs-header">
                        <h2><i class="ph ph-list-bullets"></i> Backup Jobs</h2>
                        <button class="btn" onclick="showCreateJobModal()"><i class="ph ph-plus"></i> New Job</button>
                    </div>
                    <div id="jobs-list" class="loading">Loading jobs...</div>
                </div>
            </div>
            
            <div id="main-tab-metrics" class="main-tab-content">
                <div class="metrics-section">
                    <div class="metrics-header">
                        <h2><i class="ph ph-chart-line"></i> Storage & Cost Metrics</h2>
                    </div>
                    
                    <div id="metrics-overview" class="metrics-content active">
                        <div id="metrics-summary" class="loading">Loading metrics...</div>
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Storage Usage Over Time</h3>
                                <div class="chart-controls">
                                    <select id="storage-days" onchange="loadMetricsCharts()">
                                        <option value="7">Last 7 days</option>
                                        <option value="30" selected>Last 30 days</option>
                                        <option value="90">Last 90 days</option>
                                    </select>
                                </div>
                            </div>
                            <div style="position: relative; height: 400px;">
                                <canvas id="storage-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Cost Over Time</h3>
                                <div class="chart-controls">
                                    <select id="cost-days" onchange="loadMetricsCharts()">
                                        <option value="7">Last 7 days</option>
                                        <option value="30" selected>Last 30 days</option>
                                        <option value="90">Last 90 days</option>
                                    </select>
                                </div>
                            </div>
                            <div style="position: relative; height: 400px;">
                                <canvas id="cost-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div id="metrics-history" class="metrics-content">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Storage by Storage Class</h3>
                                <div class="chart-controls">
                                    <select id="history-days" onchange="loadHistoryChart()">
                                        <option value="7">Last 7 days</option>
                                        <option value="30" selected>Last 30 days</option>
                                        <option value="90">Last 90 days</option>
                                    </select>
                                </div>
                            </div>
                            <div style="position: relative; height: 400px;">
                                <canvas id="history-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div id="metrics-projection" class="metrics-content">
                        <div id="projection-content" class="loading">Loading projections...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Sync Results Modal -->
    <div id="sync-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sync Results</h2>
                <button class="modal-close" onclick="closeSyncModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="sync-status" class="loading">Checking sync status...</div>
                <div id="sync-issues" style="display: none;">
                    <h3>Issues Found</h3>
                    <div id="sync-issues-list"></div>
                    <div class="modal-footer" style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="btn" onclick="closeSyncModal()">Close</button>
                        <button class="btn btn-primary" id="sync-fix-btn" onclick="applySyncFixes()">Apply Fixes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create/Edit Job Modal -->
    <div id="create-job-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="job-modal-title">Create Backup Job</h2>
            </div>
            <div class="modal-body">
                <form id="create-job-form" onsubmit="saveJob(event)">
                <div class="form-group">
                    <label>Job Name *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Job Type *</label>
                    <select name="job_type" required>
                        <option value="dataset">Dataset</option>
                        <option value="host">Host (Restic)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Source Paths (one per line) *</label>
                    <textarea name="source_paths" rows="3" required placeholder="/mnt/media&#10;/mnt/immich"></textarea>
                </div>
                <div class="form-group">
                    <label>Schedule *</label>
                    <select name="schedule" required>
                        <option value="hourly">Hourly</option>
                        <option value="daily" selected>Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>S3 Bucket *</label>
                    <input type="text" name="s3_bucket" required>
                </div>
                <div class="form-group">
                    <label>S3 Prefix *</label>
                    <input type="text" name="s3_prefix" required placeholder="backups/job-name">
                </div>
                <div class="form-group">
                    <label>Storage Class *</label>
                    <select name="storage_class" required>
                        <option value="GLACIER_IR">Glacier Instant Retrieval</option>
                        <option value="GLACIER_FLEXIBLE">Glacier Flexible Retrieval</option>
                        <option value="DEEP_ARCHIVE" selected>Glacier Deep Archive</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="incremental_enabled" checked>
                        Enable incremental backups (only backup new/changed files)
                    </label>
                    <small style="display: block; color: #666; margin-top: 5px;">
                        Recommended for daily/weekly backups. First backup will be full, subsequent backups only include changes.
                    </small>
                </div>
                    <input type="hidden" name="job_id" id="job-id-field">
                </form>
            </div>
            <div class="modal-footer">
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="closeCreateJobModal()"><i class="ph ph-x"></i> Cancel</button>
                    <button type="submit" form="create-job-form" class="btn btn-success" id="job-submit-btn"><i class="ph ph-check"></i> Create Job</button>
                </div>
            </div>
        </div>
    </div>
    
    

    <script type="module" src="/static/js/main.js"></script>
</body>
</html>
